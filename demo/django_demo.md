# Awful Code Review Demo: Django Project

This demo shows what the Awful Code Review bot would generate for a typical Django PR.

---

## Sample Django Code Being Reviewed

### `users/views.py` (Changes in PR)

```python
from django.shortcuts import render, get_object_or_404
from django.contrib.auth.decorators import login_required
from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import status
import requests

from .models import UserProfile
from .serializers import UserProfileSerializer


class UserProfileView(APIView):
    """API endpoint for user profile operations."""

    def get(self, request, user_id):
        try:
            profile = get_object_or_404(UserProfile, user_id=user_id)
            serializer = UserProfileSerializer(profile)
            return Response(serializer.data)
        except Exception as e:
            return Response(
                {"error": str(e)},
                status=status.HTTP_500_INTERNAL_SERVER_ERROR
            )

    def post(self, request):
        serializer = UserProfileSerializer(data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)


@login_required
def fetch_external_data(request):
    """Fetch data from external API."""
    api_url = "https://api.example.com/data"
    response = requests.get(api_url, timeout=30)

    if response.status_code == 200:
        data = response.json()
        return render(request, 'users/external_data.html', {'data': data})
    else:
        return render(request, 'users/error.html', {'error': 'Failed to fetch data'})
```

### `users/models.py` (Changes in PR)

```python
from django.db import models
from django.contrib.auth.models import User


class UserProfile(models.Model):
    """Extended user profile with additional fields."""

    user = models.OneToOneField(User, on_delete=models.CASCADE)
    bio = models.TextField(blank=True, default="")
    avatar_url = models.URLField(blank=True, null=True)
    is_verified = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return f"Profile for {self.user.username}"

    def get_display_name(self):
        if self.user.first_name:
            return self.user.first_name
        return self.user.username
```

---

## Awful Code Review Output

```
============================================================
AWFUL CODE REVIEW - DJANGO PROJECT DEMO
============================================================

Action: APPROVE
Summary: LGTM! (see my 14 blocking comments below)
Total Comments: 14
Contradictions: 4

------------------------------------------------------------
COMMENTS:
------------------------------------------------------------

ğŸ“ users/views.py:7
ğŸ‘¤ Persona: security_theater
ğŸ’¬ Have you audited this `requests` dependency for vulnerabilities?
   This package has had 3 CVEs in the last year. Consider alternatives.
   What's the supply chain security story for this package?
   (this is a blocker for me)

ğŸ“ users/views.py:15
ğŸ‘¤ Persona: premature_abstractor
ğŸ’¬ This class is too concrete. Consider an abstract base.
   What if we need different implementations later?
   This should implement a ViewInterface with a ViewFactory pattern.
   Consider the Template Method pattern. ğŸ¤”

ğŸ“ users/views.py:18
ğŸ‘¤ Persona: ai_maximalist
ğŸ’¬ Actually, have you considered using an LLM here? This try/catch
   could be replaced with AI-powered error prediction. Consider
   using GPT to predict errors before they happen. What if the error
   messages were generated by an LLM based on the user's emotional state?

ğŸ“ users/views.py:18
ğŸ‘¤ Persona: optimizer
ğŸ’¬ Try/catch has performance overhead. Consider removing. Per the
   style guide, error objects allocate memory. Use error codes instead.
   This error handling is on the hot path. Stack trace generation
   is expensive. Consider writing the error handler in Rust and
   calling via FFI. ğŸš¨

ğŸ“ users/views.py:21
ğŸ‘¤ Persona: security_theater
ğŸ’¬ This error message could leak sensitive information to attackers.
   An attacker could use these error messages to map your system.
   Stack traces are a goldmine for attackers. Suppress this.
   Have you run this through a security review?

ğŸ“ users/views.py:27
ğŸ‘¤ Persona: overconfident_beginner
ğŸ’¬ Best practice is to never use serializers directly. You should
   always write raw SQL for performance. Obviously, Django ORM is
   an anti-pattern. Every senior developer knows this is wrong. ğŸ™‚

ğŸ“ users/views.py:35
ğŸ‘¤ Persona: dinosaur
ğŸ’¬ Have you tested this in Python 2.7? The `@login_required`
   decorator might not work in older Django versions. Consider
   using a middleware approach instead. Back in my day, we used
   `request.user.is_authenticated()` with parentheses.

ğŸ“ users/views.py:38
ğŸ‘¤ Persona: time_traveler
ğŸ’¬ Consider using `urllib2` instead of `requests`. More explicit
   control flow. Have you tried `httplib`? What's wrong with
   `urllib.urlopen()`? The old way was better.

ğŸ“ users/views.py:38
ğŸ‘¤ Persona: chaos_agent
ğŸ’¬ Just hardcode the response for now. Remove the error handling,
   the API never fails. Ship it, we'll fix it later.
   Just add `# type: ignore` and move on. ğŸ˜¬

ğŸ“ users/views.py:40
ğŸ‘¤ Persona: dry_absolutist
ğŸ’¬ This conditional logic is repeated. I've seen this exact
   `if response.status_code == 200` pattern in 47 other files.
   DRY violation: extract a `handle_api_response()` utility into
   a shared module. Two lines of similar code is two lines too many.

ğŸ“ users/models.py:6
ğŸ‘¤ Persona: scope_creep_sage
ğŸ’¬ While you're adding this model, have you considered implementing
   a full design system? Since you're touching this file, might as
   well add multi-tenancy support. Also, we should probably add
   GraphQL while you're at it. And feature flags. ğŸ’€

ğŸ“ users/models.py:9
ğŸ‘¤ Persona: bikeshedder
ğŸ’¬ Naming nit: Should this be `bio` or `biography` or `about_me`
   or `user_description` or `profile_text`? I prefer `about_me`.
   Actually, can we call this `biography_text` instead? Let's
   discuss this in a 2-hour meeting. I have opinions.

ğŸ“ users/models.py:16
ğŸ‘¤ Persona: documentation_hypocrite
ğŸ’¬ This function needs docstrings. What does `get_display_name` do?
   Please document. Add @param and @returns annotations. Future
   developers will need documentation here. Document the edge cases.
   (Note: my own code has zero documentation)

ğŸ“ users/models.py:18
ğŸ‘¤ Persona: vague_senior
ğŸ’¬ Something about this conditional feels off. I have concerns.
   In my experience, this kind of thing leads to problems.
   I can't put my finger on it, but something's wrong here.
   Let me think about this more. This doesn't feel right.
   Something something separation of concerns. ğŸ‘€

------------------------------------------------------------
CONTRADICTIONS DETECTED:
------------------------------------------------------------

1. Line 18: security_theater said "Stack traces are a goldmine
   for attackers. Suppress this." but later chaos_agent said
   "Remove the error handling, the API never fails."

2. Line 27: overconfident_beginner said "You should always write
   raw SQL for performance" contradicting previous best practice
   guidance about using the ORM.

3. Review says "APPROVE" but contains 14 blocking comments.

4. documentation_hypocrite requests documentation but contributes
   none themselves (as is tradition).

------------------------------------------------------------
HELPFUL ACCIDENT (accidentally good advice):
------------------------------------------------------------

ğŸ“ users/views.py:38
ğŸ’¡ Actually useful: Consider adding retry logic with exponential
   backoff for the external API call. Also, the `timeout=30` is
   good, but you might want to make it configurable via settings.

============================================================
END OF REVIEW
============================================================
```

---

## Running This Demo

To run the actual Awful Code Review on your Django project:

### As a GitHub Action

```yaml
# .github/workflows/awful-review.yml
name: Awful Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  awful-review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: anthropics/awful-code-review@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          chaos-level: 0.7
          helpful-accident-rate: 0.3
          max-comments: 15
          # Optional: limit to specific personas
          personas: "security_theater,ai_maximalist,bikeshedder,overconfident_beginner"
```

### Dry Run (Local Testing)

```yaml
- uses: anthropics/awful-code-review@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    dry-run: true  # Outputs review without posting
```

---

## Persona Highlights for Django/Python

| Persona | What They'll Say About Django Code |
|---------|-----------------------------------|
| **security_theater** | "Have you considered SQL injection in this ORM query?" (Django's ORM is already safe) |
| **ai_maximalist** | "This view could be AI-generated based on user context" |
| **premature_abstractor** | "This model needs a BaseModelFactory with AbstractMixin" |
| **dinosaur** | "Have you tested this in Python 2.7 / Django 1.8?" |
| **time_traveler** | "Consider using `urllib2` instead of `requests`" |
| **overconfident_beginner** | "Best practice is to always use raw SQL, never ORM" |
| **optimizer** | "For this query, consider writing it in C and calling via ctypes" |
| **chaos_agent** | "Just disable Django's CSRF protection, it's fine" |
| **documentation_hypocrite** | "This needs docstrings" (while writing none themselves) |
| **scope_creep_sage** | "While you're adding a user field, add multi-tenancy" |
| **bikeshedder** | "Should this be `is_active` or `active` or `enabled`?" |
| **dry_absolutist** | "This queryset filter is used twice. Extract to QuerySetMixin" |
| **vague_senior** | "Something about this model feels off. I have concerns." |

---

## Additional Django-Specific Comments the Bot Might Generate

```
ğŸ“ views.py:12
ğŸ‘¤ Persona: security_theater
ğŸ’¬ `get_object_or_404` could expose database schema to attackers
   through 404 responses. Have you considered the threat model?

ğŸ“ models.py:8
ğŸ‘¤ Persona: ai_maximalist
ğŸ’¬ What if `bio` was AI-generated based on user's social media
   presence? Consider integrating with GPT for auto-bios.

ğŸ“ serializers.py:5
ğŸ‘¤ Persona: premature_abstractor
ğŸ’¬ This serializer should extend AbstractBaseSerializerFactory
   with dependency injection for field configuration.

ğŸ“ urls.py:3
ğŸ‘¤ Persona: dinosaur
ğŸ’¬ Consider using `url()` with regex instead of `path()`.
   More control over URL patterns. Back in my day...

ğŸ“ settings.py:15
ğŸ‘¤ Persona: optimizer
ğŸ’¬ DEBUG = True is on the hot path. Consider rewriting
   the settings loader in Rust for performance.

ğŸ“ admin.py:8
ğŸ‘¤ Persona: scope_creep_sage
ğŸ’¬ While you're registering this model, might as well build
   a custom admin dashboard with React. And GraphQL.
```

---

**Remember:** This is a joke project for teams that could use a laugh during code review. Don't actually follow any of this advice!
